{"version":3,"sources":["init.js","controllers/application.controller.js","controllers/cat_index.controller.js","controllers/cat_new.controller.js","controllers/user_new.controller.js","main.js"],"names":["developmentMode","BASE_URL","window","reqKitConstants","catTemplate","fmTemplate","ApiCatIndex","ApiCatCreate","ApiEmotionIndex","ApiUserCreate","ApiKey","reqKitControllers","$","prepend","application","flashMessageContainer","flashMessageText","fetchEmotions","ajax","method","contentType","headers","Authorization","populateEmotionsSelect","destination","defaultText","showBlankOption","options","this","then","emotions","_items","map","emo","name","html","populateEmotionsList","emos","emoLis","join","fetchFlashMessageTemplate","get","template","_","bind","updateFlashMessage","msg","type","text","parent","removeClass","addClass","setTimeout","console","log","dismissFlashMessage","catIndex","extend","catPrototype","emotion","url","cats","emotionSelector","catContainer","initialize","fetchTemplate","done","data","fadeIn","generateCat","attrs","Object","create","fetchCats","optsString","buildCatArray","catJson","cat","populateCatContainer","results","domCats","update","catNew","fieldUrl","fieldEmotion","fieldOwner","fieldApiKey","savedCats","postCatData","JSON","stringify","dataType","processData","handleSubmit","val","owner","attr","push","fadeOut","err","status","userNew","form","fieldEmail","fieldSubmit","fieldSubmitIcon","apiKeyContainer","apiKeySpan","apiKey","requestKey","updateState","state","slideUp","removeAttr","email","response","api_key","alert","percentext","width","maxFontSize","on"],"mappings":"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","file":"app.js","sourcesContent":["// The first JS file loaded.\n\n\n(function() {\n  var developmentMode = false;\n\n  var BASE_URL = developmentMode ? 'http://localhost:3000' : 'http://requestkittens.com';\n\n  window.reqKitConstants = {\n    catTemplate:      developmentMode ? '/templates/cat.template.html' : '/RequestKittensDocs/public/templates/cat.template.html',\n    fmTemplate:       developmentMode ? '/templates/flash_message.template.html' : '/RequestKittensDocs/public/templates/flash_message.template.html',\n    ApiCatIndex:      BASE_URL+'/cats',\n    ApiCatCreate:     BASE_URL+'/cats',\n    ApiEmotionIndex:  BASE_URL+'/emotions',\n    ApiUserCreate:    BASE_URL+'/users',\n    ApiKey:           '7d791ff16add503b2542c23afb3aeab0'\n  };\n\n  window.reqKitControllers = {};\n\n  if (!developmentMode) {\n    // Add our <base> tag to the top of our <head>\n    $(\"head\").prepend('<base href=\"http://joshwcomeau.github.io/RequestKittensDocs/public/\">')\n  }\n}());","// A series of helper methods that can be used by all other controllers,\n// through concatenative inheritance.\nwindow.reqKitControllers.application = {\n  \n  flashMessageContainer:  \"#flash-message\",\n  flashMessageText:       \"#flash-message h4\",\n\n  fetchEmotions: function() {\n    return $.ajax(window.reqKitConstants.ApiEmotionIndex, {\n      method: 'GET',\n      contentType: \"application/json\",\n      headers: {\n        'Authorization': window.reqKitConstants.ApiKey\n      }\n    });\n  },\n  populateEmotionsSelect: function(destination, defaultText, showBlankOption) {\n    var options = showBlankOption ? \"<option>\"+defaultText+\"</option>\" : \"\";\n\n    return this.fetchEmotions()\n    .then(function(emotions) {\n      options += emotions._items.map(function(emo) {\n        return \"<option value='\"+ emo.name +\"'>\"+ emo.name +\"</option>\";\n      });\n\n      $(destination).html(options);\n\n      return emotions;\n    });\n  },\n\n  populateEmotionsList: function(emos, destination) {\n    var emoLis = \"\";\n\n    emoLis += emos._items.map(function(emo) {\n      return \"<li>\"+ emo.name +\"</li>\";\n    }).join(\"\");\n\n    return $(destination).html(emoLis);\n  },\n\n  fetchFlashMessageTemplate: function() {\n\n    return $.get( window.reqKitConstants.fmTemplate, function(template) {\n      $(\"body\").prepend(_.template(template)());\n    }.bind(this), 'html');\n  },\n\n  updateFlashMessage: function(msg, type) {\n    // The idea with flash messages is they always exist, they're just hidden off-screen normally.\n    // We update the message, show it, wait a few seconds, and hide it.\n\n    $(this.flashMessageText)\n      .text(msg)\n      .parent()\n      .removeClass()\n      .addClass(\"visible \" + type);\n\n    // auto-hide it after a few seconds\n    window.setTimeout(function() {\n      console.log($(this.flashMessageContainer));\n      $(this.flashMessageContainer).removeClass(\"visible\");\n    }.bind(this), 5000);\n  },\n\n  dismissFlashMessage: function() {\n    $(this.flashMessageContainer).removeClass();\n  }\n\n};","window.reqKitControllers.catIndex = _.extend({}, window.reqKitControllers.application, {\n\n  catPrototype: {\n    emotion: null,\n    url:     null\n    // More stuff can be added here (photo source, custom behavior, etc)\n  },\n\n  cats: [],\n\n  emotionSelector: \"#select-emotion\",\n  catContainer:    \"#cat-container\",\n\n  initialize: function() {\n    this.cats = [];\n\n    this.fetchTemplate(window.reqKitConstants.catTemplate)\n    .done(function(data) { \n      this.template = _.template(data);\n    }.bind(this));\n\n    this.populateEmotionsSelect(this.emotionSelector, \"&nbsp;\", true)\n    .then(function(emos) {\n      return this.populateEmotionsList(emos, \".list-of-emotions\");\n    }.bind(this))\n    .then(function() {\n      $(\"#demo h3\").fadeIn(500);\n    });\n  },\n\n  generateCat: function(attrs) {\n    return _.extend(Object.create(this.catPrototype), attrs);\n  },\n\n  /***** \n    Store our Cat template locally\n  ******/\n  fetchTemplate: function(url) {\n    return $.get( url, function(template) {\n      return template;\n    }.bind(this), 'html');\n  },\n\n  fetchCats: function(emotion) {\n    var optsString = \"?numOfResults=4\";\n\n    return $.ajax(window.reqKitConstants.ApiCatIndex+optsString, {\n      data: {\n        emotion: emotion\n      },\n      headers: {\n        'Authorization': window.reqKitConstants.ApiKey\n      }\n    });\n  },\n\n\n  /***** \n    Use our cat prototype to build an array of cat objects.\n    This adds custom behavior to the server data.\n  ******/\n  buildCatArray: function(catJson) {\n    console.log(this);\n    return catJson.map(function(cat) { \n\n      return this.generateCat(cat); \n    }.bind(this));\n  },\n\n  populateCatContainer: function(results) {\n    var domCats;\n\n    this.cats = this.buildCatArray(results._items);\n\n    // We have our cat data. Now we need to iterate through them creating templates with them.\n    domCats = this.cats.map(function(cat) {\n      return this.template(cat);\n    }.bind(this));\n\n    // Let's concatenate all those templates, and shove 'em in the DOM!\n    $(this.catContainer).html(domCats.join(\"\"));\n  },\n\n  /***** \n    Our main function. Triggered by the select menu, causes the view to update.\n  ******/\n  update: function(emotion) {\n    this.fetchCats(emotion)\n    .then(function(results) {\n      this.populateCatContainer(results);\n    }.bind(this));\n  }\n\n\n});\n","window.reqKitControllers.catNew = _.extend({}, window.reqKitControllers.application, {\n\n  // The CSS selectors for our various form fields\n  fieldUrl:     \"#field-url\",\n  fieldEmotion: \"#field-emotion\",\n  fieldOwner:   \"#field-owner\",\n  fieldApiKey:  \"#field-api-key\",\n\n  savedCats: [],\n\n  initialize: function() {\n    this.populateEmotionsSelect(this.fieldEmotion, \"select one\", true);\n  },\n\n  postCatData: function(data, headers) {\n    return $.ajax(window.reqKitConstants.ApiCatCreate, {\n      method:       'POST',\n      data:         JSON.stringify(data),\n      headers:      headers,\n      dataType:     'json',\n      contentType:  'application/json',\n      processData:  false\n    });\n  },\n\n  handleSubmit: function() {\n    var data = {\n      url:      $(this.fieldUrl).val(),\n      emotion:  $(this.fieldEmotion).val(),\n      owner:   $(this.fieldOwner).val()\n    };\n\n    var headers = {\n      'Authorization': $(this.fieldApiKey).val()\n    };\n\n    // We need to do something to ensure the user knows the request is in progress.\n    // For now, we're showing a black overlay and updating the submit button.\n    $(\".black-overlay\").fadeIn(200);\n    $(\".submit\").addClass(\"in-progress\").text(\"Submitting...\");\n\n\n\n    if ( !$(this.fieldEmotion + \" option:selected\").attr(\"value\")) {\n      this.updateFlashMessage(\"Please select an emotion\", \"alert\");\n      return false;\n    }\n\n    this.postCatData(data, headers)\n    .then(function(results) {\n      this.savedCats.push(results);\n\n      // Remove visual cues\n      $(\".black-overlay\").fadeOut(200);\n      $(\".submit\").removeClass(\"in-progress\").text(\"Submit Photo\");\n\n      // Clear form fields\n      $(\"#field-url, #field-credit, #field-emotion\").val(\"\");\n\n      // Display success message\n      this.updateFlashMessage(\"Successfully saved cat!\", \"success\");\n\n    }.bind(this), function(err) {\n      if (err.status === 401) {\n        this.updateFlashMessage(\"You need to be an administrator to add cats.\", \"alert\");\n      }\n      console.log(\"Oh no! Something bad happened:\", err);\n    }.bind(this));\n\n\n  }\n\n\n});\n","window.reqKitControllers.userNew = _.extend({}, window.reqKitControllers.application, {\n  form:             \"#request-api-key-form\",\n  fieldEmail:       \"#request-api-key-email\",\n  fieldSubmit:      \"#request-api-key-submit\",\n  fieldSubmitIcon:  \"#request-api-key-icon\",\n\n  apiKeyContainer:  \".api-key-container\",\n  apiKeySpan:       \".api-key\",\n\n  apiKey:           null,\n\n  initialize: function() {\n\n  },\n\n  requestKey: function(data) {\n    return $.ajax(window.reqKitConstants.ApiUserCreate, {\n      method: \"POST\",\n      data: JSON.stringify(data),\n      contentType: \"application/json\"\n    });\n  },\n\n  updateState: function(state) {\n    if ( state === \"processing\" ) {\n      $(this.fieldEmail).addClass(\"shrunken\");\n      $(this.fieldSubmit).addClass(\"sending\");\n      $(this.fieldSubmitIcon).removeClass(\"fa-chevron-right\").addClass(\"fa-cog fa-spin\");\n    } else if ( state === \"error\" ) {\n      $(this.fieldEmail).val(\"\");\n      $(this.fieldSubmit).addClass(\"error\");\n      $(this.fieldSubmitIcon).removeClass(\"fa-cog fa-spin\").addClass(\"fa-times\");\n      window.setTimeout(function() { this.updateState(\"default\"); }.bind(this), 3000);\n    } else if ( state === \"completed\" ) {\n      $(this.fieldSubmit).addClass(\"completed\");\n      $(this.fieldSubmitIcon).removeClass(\"fa-cog fa-spin\").addClass(\"fa-check\");\n      \n      window.setTimeout(function() {\n        $(this.form).slideUp(500);\n      }.bind(this), 1000);\n\n      window.setTimeout(function() {\n        $(this.apiKeyContainer).fadeIn(500);\n      }.bind(this), 1500);\n    } else if ( state === \"default\" ) {\n      $(this.fieldEmail).removeClass(\"shrunken\");\n      $(this.fieldSubmit).removeAttr(\"class\");\n      $(this.fieldSubmitIcon).attr(\"class\", \"fa fa-chevron-right\");\n    }\n  },\n\n  handleSubmit: function() {\n    var data = {\n      email: $(this.fieldEmail).val()\n    };\n\n    if ( !data.email ) {\n      alert(\"We require an email, silly!\");\n      return false;\n    }\n\n    // visual cues - change submit style and submit icon contents\n    this.updateState(\"processing\");\n\n    this.requestKey(data)\n    .then(function(response) {\n      this.apiKey = response.api_key;\n      $(this.apiKeySpan).text(this.apiKey);\n\n      this.updateState(\"completed\");\n    }.bind(this), function(err) {\n      this.updateFlashMessage(\"Something went wrong T_T\", \"alert\");\n      this.updateState(\"error\");\n    }.bind(this));\n  }\n\n});","// Main application logic goes here!\n$(\"header.full-ver h2\").percentext({width: 75, maxFontSize: 130});\n$(\"header.full-ver h5\").percentext({width: 78, maxFontSize: 36});\n\n$(\"header.smaller-ver h2\").percentext({width: 50, maxFontSize: 100});\n$(\"header.smaller-ver h5\").percentext({width: 55, maxFontSize: 30});\n\n// Tie the 'update' function on the Select change\n$(\"#select-emotion\").on(\"change\", function() {\n  $(\"section#demo\").addClass(\"has-cats\");\n  \n  var emotion = $(this).val();\n  window.reqKitControllers.catIndex.update(emotion);\n});\n\n"],"sourceRoot":"/source/"}