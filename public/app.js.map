{"version":3,"sources":["init.js","controllers/application.controller.js","controllers/cat_index.controller.js","controllers/cat_new.controller.js","controllers/user_new.controller.js","main.js"],"names":["BASE_URL","window","reqKitConstants","catTemplate","fmTemplate","ApiCatIndex","ApiCatCreate","ApiEmotionIndex","ApiUserCreate","ApiKey","reqKitControllers","application","flashMessageContainer","flashMessageText","fetchEmotions","$","ajax","method","contentType","headers","Authorization","populateEmotionsSelect","destination","defaultText","showBlankOption","options","this","then","emotions","_items","map","emo","name","html","populateEmotionsList","emos","emoLis","join","fetchFlashMessageTemplate","get","template","prepend","_","bind","updateFlashMessage","msg","type","text","parent","removeClass","addClass","setTimeout","console","log","dismissFlashMessage","catIndex","extend","catPrototype","emotion","url","cats","emotionSelector","catContainer","initialize","fetchTemplate","done","data","fadeIn","generateCat","attrs","Object","create","fetchCats","buildCatArray","catJson","cat","populateCatContainer","results","domCats","update","catNew","fieldUrl","fieldEmotion","fieldCredit","fieldApiKey","savedCats","postCatData","JSON","stringify","dataType","processData","handleSubmit","val","credit","attr","push","fadeOut","err","status","userNew","form","fieldEmail","fieldSubmit","fieldSubmitIcon","apiKeyContainer","apiKeySpan","apiKey","requestKey","updateState","state","slideUp","removeAttr","email","response","api_key","alert","percentext","width","maxFontSize","on"],"mappings":"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","file":"app.js","sourcesContent":["// The first JS file loaded.\n(function() {\n  var BASE_URL = 'http://localhost:3000';\n\n  window.reqKitConstants = {\n    catTemplate:      '/templates/cat.template.html',\n    fmTemplate:       '/templates/flash_message.template.html',\n    ApiCatIndex:      BASE_URL+'/cats',\n    ApiCatCreate:     BASE_URL+'/cats',\n    ApiEmotionIndex:  BASE_URL+'/emotions',\n    ApiUserCreate:    BASE_URL+'/users',\n    ApiKey:           '7d791ff16add503b2542c23afb3aeab0'\n  };\n\n  window.reqKitControllers = {};\n}());","// A series of helper methods that can be used by all other controllers,\n// through concatenative inheritance.\nwindow.reqKitControllers.application = {\n  \n  flashMessageContainer:  \"#flash-message\",\n  flashMessageText:       \"#flash-message h4\",\n\n  fetchEmotions: function() {\n    return $.ajax(window.reqKitConstants.ApiEmotionIndex, {\n      method: 'GET',\n      contentType: \"application/json\",\n      headers: {\n        'Authorization': window.reqKitConstants.ApiKey\n      }\n    });\n  },\n  populateEmotionsSelect: function(destination, defaultText, showBlankOption) {\n    var options = showBlankOption ? \"<option>\"+defaultText+\"</option>\" : \"\";\n\n    return this.fetchEmotions()\n    .then(function(emotions) {\n      options += emotions._items.map(function(emo) {\n        return \"<option value='\"+ emo.name +\"'>\"+ emo.name +\"</option>\";\n      });\n\n      $(destination).html(options);\n\n      return emotions;\n    });\n  },\n\n  populateEmotionsList: function(emos, destination) {\n    var emoLis = \"\";\n\n    emoLis += emos._items.map(function(emo) {\n      return \"<li>\"+ emo.name +\"</li>\";\n    }).join(\"\");\n\n    return $(destination).html(emoLis);\n  },\n\n  fetchFlashMessageTemplate: function() {\n\n    return $.get( window.reqKitConstants.fmTemplate, function(template) {\n      $(\"body\").prepend(_.template(template)());\n    }.bind(this), 'html');\n  },\n\n  updateFlashMessage: function(msg, type) {\n    // The idea with flash messages is they always exist, they're just hidden off-screen normally.\n    // We update the message, show it, wait a few seconds, and hide it.\n\n    $(this.flashMessageText)\n      .text(msg)\n      .parent()\n      .removeClass()\n      .addClass(\"visible \" + type);\n\n    // auto-hide it after a few seconds\n    window.setTimeout(function() {\n      console.log($(this.flashMessageContainer));\n      $(this.flashMessageContainer).removeClass(\"visible\");\n    }.bind(this), 5000);\n  },\n\n  dismissFlashMessage: function() {\n    $(this.flashMessageContainer).removeClass();\n  }\n\n};","window.reqKitControllers.catIndex = _.extend({}, window.reqKitControllers.application, {\n\n  catPrototype: {\n    emotion: null,\n    url:     null\n    // More stuff can be added here (photo source, custom behavior, etc)\n  },\n\n  cats: [],\n\n  emotionSelector: \"#select-emotion\",\n  catContainer:    \"#cat-container\",\n\n  initialize: function() {\n    this.cats = [];\n\n    this.fetchTemplate(window.reqKitConstants.catTemplate)\n    .done(function(data) { \n      this.template = _.template(data);\n    }.bind(this));\n\n    this.populateEmotionsSelect(this.emotionSelector, \"&nbsp;\", true)\n    .then(function(emos) {\n      return this.populateEmotionsList(emos, \".list-of-emotions\");\n    }.bind(this))\n    .then(function() {\n      $(\"#demo h3\").fadeIn(500);\n    });\n  },\n\n  generateCat: function(attrs) {\n    return _.extend(Object.create(this.catPrototype), attrs);\n  },\n\n  /***** \n    Store our Cat template locally\n  ******/\n  fetchTemplate: function(url) {\n    return $.get( url, function(template) {\n      return template;\n    }.bind(this), 'html');\n  },\n\n  fetchCats: function(emotion) {\n    return $.ajax(window.reqKitConstants.ApiCatIndex, {\n      data: {\n        emotion: emotion\n      },\n      headers: {\n        'Authorization': window.reqKitConstants.ApiKey\n      }\n    });\n  },\n\n\n  /***** \n    Use our cat prototype to build an array of cat objects.\n    This adds custom behavior to the server data.\n  ******/\n  buildCatArray: function(catJson) {\n    console.log(this);\n    return catJson.map(function(cat) { \n\n      return this.generateCat(cat); \n    }.bind(this));\n  },\n\n  populateCatContainer: function(results) {\n    var domCats;\n\n    this.cats = this.buildCatArray(results._items);\n\n    // We have our cat data. Now we need to iterate through them creating templates with them.\n    domCats = this.cats.map(function(cat) {\n      return this.template(cat);\n    }.bind(this));\n\n    // Let's concatenate all those templates, and shove 'em in the DOM!\n    $(this.catContainer).html(domCats.join(\"\"));\n  },\n\n  /***** \n    Our main function. Triggered by the select menu, causes the view to update.\n  ******/\n  update: function(emotion) {\n    this.fetchCats(emotion)\n    .then(function(results) {\n      this.populateCatContainer(results);\n    }.bind(this));\n  }\n\n\n});\n","window.reqKitControllers.catNew = _.extend({}, window.reqKitControllers.application, {\n\n  // The CSS selectors for our various form fields\n  fieldUrl:     \"#field-url\",\n  fieldEmotion: \"#field-emotion\",\n  fieldCredit:  \"#field-credit\",\n  fieldApiKey:  \"#field-api-key\",\n\n  savedCats: [],\n\n  initialize: function() {\n    this.populateEmotionsSelect(this.fieldEmotion, \"select one\", true);\n  },\n\n  postCatData: function(data, headers) {\n    return $.ajax(window.reqKitConstants.ApiCatCreate, {\n      method:       'POST',\n      data:         JSON.stringify(data),\n      headers:      headers,\n      dataType:     'json',\n      contentType:  'application/json',\n      processData:  false\n    });\n  },\n\n  handleSubmit: function() {\n    var data = {\n      url:      $(this.fieldUrl).val(),\n      emotion:  $(this.fieldEmotion).val(),\n      credit:   $(this.fieldCredit).val()\n    };\n\n    var headers = {\n      'Authorization': $(this.fieldApiKey).val()\n    };\n\n    // We need to do something to ensure the user knows the request is in progress.\n    // For now, we're showing a black overlay and updating the submit button.\n    $(\".black-overlay\").fadeIn(200);\n    $(\".submit\").addClass(\"in-progress\").text(\"Submitting...\");\n\n\n\n    if ( !$(this.fieldEmotion + \" option:selected\").attr(\"value\")) {\n      this.updateFlashMessage(\"Please select an emotion\", \"alert\");\n      return false;\n    }\n\n    this.postCatData(data, headers)\n    .then(function(results) {\n      this.savedCats.push(results);\n\n      // Remove visual cues\n      $(\".black-overlay\").fadeOut(200);\n      $(\".submit\").removeClass(\"in-progress\").text(\"Submit Photo\");\n\n      // Clear form fields\n      $(\"#field-url, #field-credit, #field-emotion\").val(\"\");\n\n      // Display success message\n      this.updateFlashMessage(\"Successfully saved cat!\", \"success\");\n\n    }.bind(this), function(err) {\n      if (err.status === 401) {\n        this.updateFlashMessage(\"You need to be an administrator to add cats.\", \"alert\");\n      }\n      console.log(\"Oh no! Something bad happened:\", err);\n    }.bind(this));\n\n\n  }\n\n\n});\n","window.reqKitControllers.userNew = _.extend({}, window.reqKitControllers.application, {\n  form:             \"#request-api-key-form\",\n  fieldEmail:       \"#request-api-key-email\",\n  fieldSubmit:      \"#request-api-key-submit\",\n  fieldSubmitIcon:  \"#request-api-key-icon\",\n\n  apiKeyContainer:  \".api-key-container\",\n  apiKeySpan:       \".api-key\",\n\n  apiKey:           null,\n\n  initialize: function() {\n\n  },\n\n  requestKey: function(data) {\n    return $.ajax(window.reqKitConstants.ApiUserCreate, {\n      method: \"POST\",\n      data: JSON.stringify(data),\n      contentType: \"application/json\"\n    });\n  },\n\n  updateState: function(state) {\n    if ( state === \"processing\" ) {\n      $(this.fieldEmail).addClass(\"shrunken\");\n      $(this.fieldSubmit).addClass(\"sending\");\n      $(this.fieldSubmitIcon).removeClass(\"fa-chevron-right\").addClass(\"fa-cog fa-spin\");\n    } else if ( state === \"error\" ) {\n      $(this.fieldEmail).val(\"\");\n      $(this.fieldSubmit).addClass(\"error\");\n      $(this.fieldSubmitIcon).removeClass(\"fa-cog fa-spin\").addClass(\"fa-times\");\n      window.setTimeout(function() { this.updateState(\"default\"); }.bind(this), 3000);\n    } else if ( state === \"completed\" ) {\n      $(this.fieldSubmit).addClass(\"completed\");\n      $(this.fieldSubmitIcon).removeClass(\"fa-cog fa-spin\").addClass(\"fa-check\");\n      \n      window.setTimeout(function() {\n        $(this.form).slideUp(500);\n      }.bind(this), 1000);\n\n      window.setTimeout(function() {\n        $(this.apiKeyContainer).fadeIn(500);\n      }.bind(this), 1500);\n    } else if ( state === \"default\" ) {\n      $(this.fieldEmail).removeClass(\"shrunken\");\n      $(this.fieldSubmit).removeAttr(\"class\");\n      $(this.fieldSubmitIcon).attr(\"class\", \"fa fa-chevron-right\");\n    }\n  },\n\n  handleSubmit: function() {\n    var data = {\n      email: $(this.fieldEmail).val()\n    };\n\n    if ( !data.email ) {\n      alert(\"We require an email, silly!\");\n      return false;\n    }\n\n    // visual cues - change submit style and submit icon contents\n    this.updateState(\"processing\");\n\n    this.requestKey(data)\n    .then(function(response) {\n      this.apiKey = response.api_key;\n      $(this.apiKeySpan).text(this.apiKey);\n\n      this.updateState(\"completed\");\n    }.bind(this), function(err) {\n      this.updateFlashMessage(\"Something went wrong T_T\", \"alert\");\n      this.updateState(\"error\");\n    }.bind(this));\n  }\n\n});","// Main application logic goes here!\n$(\"header.full-ver h2\").percentext({width: 75, maxFontSize: 130});\n$(\"header.full-ver h5\").percentext({width: 78, maxFontSize: 36});\n\n$(\"header.smaller-ver h2\").percentext({width: 50, maxFontSize: 100});\n$(\"header.smaller-ver h5\").percentext({width: 55, maxFontSize: 30});\n\n// Tie the 'update' function on the Select change\n$(\"#select-emotion\").on(\"change\", function() {\n  $(\"section#demo\").addClass(\"has-cats\");\n  \n  var emotion = $(this).val();\n  window.reqKitControllers.catIndex.update(emotion);\n});\n\n"],"sourceRoot":"/source/"}